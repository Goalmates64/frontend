<section class="space-y-8">
  <header class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <p class="text-xs uppercase tracking-[0.3em] text-gm-primary font-semibold">Équipes</p>
      <h1 class="text-3xl font-bold">Mes équipes</h1>
      <p class="text-gm-muted text-sm">Crée ta team ou rejoins tes amis avec un code d'invitation.</p>
    </div>
    <button
      (click)="goToCreate()"
      class="px-4 py-2 rounded-lg bg-gm-primary text-gm-bg text-sm font-semibold hover:bg-emerald-500 transition"
      type="button"
    >
      Créer une équipe
    </button>
  </header>

  <div class="grid gap-6 lg:grid-cols-[2fr,1fr]">
    <div class="space-y-4">
      <ng-container *ngIf="(teams$ | async) as teams">
        <div
          *ngIf="!teams.length && !(loading$ | async)"
          class="border border-dashed border-gm-border rounded-2xl p-6 text-center text-sm text-gm-muted"
        >
          Aucune équipe pour l'instant. Lance-toi ou colle un code !
        </div>

        <div *ngIf="loading$ | async" class="text-sm text-gm-muted">Chargement...</div>

        <article
          *ngFor="let team of teams"
          class="border border-gm-border rounded-2xl p-4 bg-gm-surface space-y-3"
        >
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
            <div>
              <p class="text-lg font-semibold">{{ team.name }}</p>
              <p class="text-xs text-gm-muted">
                Code : <span class="font-mono">{{ team.inviteCode }}</span> · Créée
                le {{ team.createdAt | date: 'mediumDate' }}
              </p>
            </div>
            <div class="flex flex-col sm:items-end">
              <span class="text-xs text-gm-muted">{{ team.members.length }} joueurs</span>
              <a
                [routerLink]="['/teams', team.id]"
                class="mt-2 text-xs text-gm-primary underline"
              >
                Voir les détails
              </a>
            </div>
          </div>

          <div class="mt-2 grid gap-2">
            <div *ngFor="let member of team.members | slice:0:3" class="flex items-center justify-between text-sm">
              <span class="font-medium">{{ member.user?.username || 'Joueur #' + member.userId }}</span>
              <span class="text-xs text-gm-muted">{{ member.isCaptain ? 'Capitaine' : 'Joueur' }}</span>
            </div>
            <div *ngIf="team.members.length > 3" class="text-xs text-gm-muted">
              + {{ team.members.length - 3 }} autres joueurs
            </div>
          </div>
        </article>
      </ng-container>
    </div>

    <aside class="border border-gm-border rounded-2xl p-6 bg-gm-surface space-y-4">
      <h2 class="text-xl font-semibold">Rejoindre une équipe</h2>
      <form (ngSubmit)="onJoinSubmit()" [formGroup]="joinForm" class="space-y-3">
        <div>
          <label class="text-xs text-gm-muted" for="code">Code d'invitation</label>
          <input
            class="mt-1 w-full rounded-lg bg-gm-surface2 border border-gm-border px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gm-primary uppercase"
            formControlName="code"
            id="code"
            placeholder="EX: ABCD1234"
          />
          <p
            *ngIf="joinForm.controls.code.invalid && joinForm.controls.code.touched"
            class="text-xs text-red-400 mt-1"
          >
            Le code doit contenir 8 caractères minimum.
          </p>
        </div>

        <div *ngIf="joinError" class="text-xs text-red-400 bg-red-950/40 border border-red-900 rounded-lg px-3 py-2">
          {{ joinError }}
        </div>

        <button
          class="w-full px-4 py-2 rounded-lg bg-gm-primary text-gm-bg text-sm font-semibold hover:bg-emerald-500 transition"
          type="submit"
        >
          Rejoindre
        </button>
      </form>
    </aside>
  </div>
</section>
