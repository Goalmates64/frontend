<section *ngIf="team$ | async as team; else loadingTpl" class="space-y-8">
  <header class="space-y-2">
    <p class="text-xs uppercase tracking-[0.3em] text-gm-primary font-semibold">Équipe</p>
    <h1 class="text-3xl font-bold">{{ team.name }}</h1>
    <p class="text-gm-muted text-sm">Créée le {{ team.createdAt | date: 'longDate' }}
      · {{ team.memberCount || team.members.length }} joueurs</p>
  </header>

  <div class="grid gap-6 lg:grid-cols-[2fr,1fr]">
    <div class="space-y-6">
      <section class="border border-gm-border rounded-2xl p-6 bg-gm-surface space-y-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-xs text-gm-muted">Code d'invitation</p>
            <p class="text-lg font-semibold font-mono">{{ team.inviteCode }}</p>
          </div>
          <button (click)="copyInviteCode(team.inviteCode)"
                  class="inline-flex items-center gap-2 text-xs text-gm-muted border border-gm-border rounded-lg px-3 py-1 hover:bg-gm-surface2">
            <i aria-hidden="true" class="fa-solid fa-copy"></i>
            <span>Copier</span>
          </button>
        </div>
        <div *ngIf="(isCaptain$ | async)" class="space-y-2">
          <label class="text-xs text-gm-muted">Renommer l'équipe</label>
          <div class="flex flex-col gap-2 sm:flex-row">
            <input
              [formControl]="renameForm.controls.name"
              class="flex-1 rounded-lg bg-gm-surface2 border border-gm-border px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gm-primary"
              placeholder="Nouveau nom"
            />
            <button (click)="saveName()"
                    class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-gm-primary text-gm-bg text-sm font-semibold hover:bg-emerald-500 transition"
                    type="button">
              <i aria-hidden="true" class="fa-solid fa-floppy-disk"></i>
              <span>Enregistrer</span>
            </button>
          </div>
        </div>
      </section>

      <section class="border border-gm-border rounded-2xl p-6 bg-gm-surface space-y-4">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-xl font-semibold">Membres</h2>
            <p class="text-xs text-gm-muted">Capitaines, joueurs et dates d'arrivée.</p>
          </div>
          <span class="text-xs text-gm-muted">{{ team.members.length }} joueurs</span>
        </div>

        <div class="divide-y divide-gm-border">
          <div *ngFor="let member of team.members; trackBy: trackMember"
               class="py-3 flex items-center justify-between text-sm">
            <div>
              <p class="font-semibold">{{ member.user?.username || ('Joueur #' + member.userId) }}</p>
              <p class="text-xs text-gm-muted">Rejoint le {{ member.joinedAt | date: 'mediumDate' }}</p>
            </div>
            <span class="text-xs text-gm-muted">{{ member.isCaptain ? 'Capitaine' : 'Joueur' }}</span>
          </div>
        </div>
      </section>
    </div>

    <aside class="space-y-6">
      <section *ngIf="(isCaptain$ | async)" class="border border-gm-border rounded-2xl p-6 bg-gm-surface">
        <h3 class="text-lg font-semibold mb-3">Inviter un joueur</h3>
        <app-user-autocomplete (userSelected)="onUserSelected($event)"></app-user-autocomplete>
        <p *ngIf="selectedUser" class="mt-2 text-xs text-gm-muted">
          Joueur sélectionné : {{ selectedUser.username }} ({{ selectedUser.email }})
        </p>
        <button
          (click)="addSelectedUser()"
          [disabled]="!selectedUser"
          class="mt-3 inline-flex w-full items-center justify-center gap-2 px-4 py-2 rounded-lg bg-gm-primary text-gm-bg text-sm font-semibold disabled:opacity-50"
          type="button"
        >
          <i aria-hidden="true" class="fa-solid fa-user-plus"></i>
          <span>Ajouter {{ selectedUser?.username || '' }}</span>
        </button>
      </section>

      <section class="border border-dashed border-gm-border rounded-2xl p-6 text-sm text-gm-muted">
        <p class="font-semibold text-gm-text mb-2">Astuce GoalMates</p>
        <p>Utilise le code d'invitation pour remplir l'équipe rapidement ou invite directement tes potes via leur
          pseudo.</p>
      </section>
    </aside>
  </div>
</section>

<ng-template #loadingTpl>
  <app-spinner label="Chargement de l'équipe..." layout="block"></app-spinner>
</ng-template>
